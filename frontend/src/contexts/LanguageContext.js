import React, { createContext, useContext, useState } from 'react';

const LanguageContext = createContext();

const translations = {
  en: {
    header: {
      title: "Impermanent Loss Calculator",
      subtitle: "Professional DeFi analysis tool for liquidity providers",
      upgradeButton: "PRO",
      resetButton: "RESET",
      themeButton: {
        dark: "DARK",
        light: "LIGHT"
      }
    },
    calculator: {
      parameters: "Parameters",
      parametersSubtitle: "Enter your position details",
      protocol: "AMM Protocol",
      protocolMulti: "MULTI-PROTOCOL",
      selectToken: "Select Token (Optional)",
      livePrices: "LIVE PRICES",
      liveData: "LIVE DATA",
      initialPrice: "Initial Price ($)",
      currentPrice: "Current Price ($)",
      poolAPY: "Pool APY (%)",
      poolAPYNew: "NEW",
      investment: "Investment ($)",
      refreshData: "Refresh Live Data",
      calculateButton: "Calculate Impermanent Loss",
      calculating: "Calculating...",
      updating: "Updating...",
      autoFilled: "AUTO-FILLED",
      popularPairs: "Popular pairs: ETH/USDT ~25-45%, BTC/USDT ~15-30%"
    },
    results: {
      title: "Analysis Results",
      subtitle: "Your position performance",
      hodlStrategy: "HODL Strategy",
      lpStrategy: "LP Strategy",
      lpStrategyWithFees: "+Fees",
      impermanentLoss: "Impermanent Loss",
      betterStrategy: "Better Strategy",
      withoutFees: "Without fees",
      afterFees: "After fees",
      scenarioAnalysis: "Scenario Analysis",
      scenarioSubtitle: "\"What if\" price changes - plan your LP strategy",
      feesAnalysis: "Fees Analysis",
      feesSubtitle: "Trading fees earnings breakdown",
      perDay: "Per Day",
      perWeek: "Per Week", 
      perMonth: "Per Month",
      total: "Days Total",
      breakEvenAnalysis: "Break-even Analysis",
      breakEvenSubtitle: "Time for fees to compensate IL",
      noILToCompensate: "No impermanent loss to compensate!",
      never: "Never",
      daysExactly: "days exactly"
    },
    education: {
      title: "Learn DeFi & Impermanent Loss",
      subtitle: "Master the fundamentals of liquidity providing",
      realTimeData: "Real-Time Pool Data",
      dataDescription: "APY rates are sourced from Uniswap V3, PancakeSwap V3, Curve, and other major DEX protocols. Data is updated every 6 hours to ensure accuracy. Volume and TVL figures reflect current market conditions."
    },
    footer: {
      company: "ILCalculator.pro",
      description: "Professional DeFi analytics for liquidity providers",
      terms: "Terms of Service",
      privacy: "Privacy Policy",
      refund: "Refund Policy",
      contact: "Contact Us",
      copyright: "¬© 2025 ILCalculator.pro",
      madeBy: "Made by Stefanson for DeFi community"
    },
    notifications: {
      dataCleared: "All data cleared! üßπ",
      welcomeDarkSide: "WELCOME TO THE DARK SIDE",
      clearConfirm: "Clear all saved data? This will reset all fields.",
      error: "Error"
    },
    tooltips: {
      upgradeTooltip: "Upgrade to Pro - Unlock all features",
      resetTooltip: "Clear all saved data - Reset the Force",
      lightSideTooltip: "Switch to Light Side",
      darkSideTooltip: "Join the Dark Side",
      changeLanguage: "Change Language"
    },
    poolData: {
      topPools: "Top %s Pools (%d found)",
      clickToUse: "Click to use APY",
      dataSource: "Data from DefiLlama.",
      findingPools: "Finding best pools for %s...",
      fetchingPrice: "Fetching live price data...",
      lastUpdated: "Last updated: %s"
    }
  },
  es: {
    header: {
      title: "Calculadora de P√©rdida Impermanente",
      subtitle: "Herramienta profesional de an√°lisis DeFi para proveedores de liquidez",
      upgradeButton: "PRO",
      resetButton: "RESET",
      themeButton: {
        dark: "OSCURO",
        light: "CLARO"
      }
    },
    calculator: {
      parameters: "Par√°metros",
      parametersSubtitle: "Ingresa los detalles de tu posici√≥n",
      protocol: "Protocolo AMM",
      protocolMulti: "MULTI-PROTOCOLO",
      selectToken: "Seleccionar Token (Opcional)",
      livePrices: "PRECIOS EN VIVO",
      liveData: "DATOS EN VIVO",
      initialPrice: "Precio Inicial ($)",
      currentPrice: "Precio Actual ($)",
      poolAPY: "APY del Pool (%)",
      poolAPYNew: "NUEVO",
      investment: "Inversi√≥n ($)",
      refreshData: "Actualizar Datos en Vivo",
      calculateButton: "Calcular P√©rdida Impermanente",
      calculating: "Calculando...",
      updating: "Actualizando...",
      autoFilled: "AUTO-COMPLETADO",
      popularPairs: "Pares populares: ETH/USDT ~25-45%, BTC/USDT ~15-30%"
    },
    results: {
      title: "Resultados del An√°lisis",
      subtitle: "Rendimiento de tu posici√≥n",
      hodlStrategy: "Estrategia HODL",
      lpStrategy: "Estrategia LP",
      lpStrategyWithFees: "+Comisiones",
      impermanentLoss: "P√©rdida Impermanente",
      betterStrategy: "Mejor Estrategia",
      withoutFees: "Sin comisiones",
      afterFees: "Despu√©s de comisiones",
      scenarioAnalysis: "An√°lisis de Escenarios",
      scenarioSubtitle: "Cambios de precio \"¬øQu√© pasar√≠a si?\" - planifica tu estrategia LP",
      feesAnalysis: "An√°lisis de Comisiones",
      feesSubtitle: "Desglose de ganancias por comisiones de trading",
      perDay: "Por D√≠a",
      perWeek: "Por Semana",
      perMonth: "Por Mes", 
      total: "D√≠as Total",
      breakEvenAnalysis: "An√°lisis de Punto de Equilibrio",
      breakEvenSubtitle: "Tiempo para que las comisiones compensen la PI",
      noILToCompensate: "¬°No hay p√©rdida impermanente que compensar!",
      never: "Nunca",
      daysExactly: "d√≠as exactamente"
    },
    education: {
      title: "Aprende DeFi y P√©rdida Impermanente",
      subtitle: "Domina los fundamentos de proveer liquidez",
      realTimeData: "Datos de Pool en Tiempo Real",
      dataDescription: "Las tasas APY provienen de Uniswap V3, PancakeSwap V3, Curve y otros protocolos DEX principales. Los datos se actualizan cada 6 horas para garantizar precisi√≥n. Las cifras de volumen y TVL reflejan las condiciones actuales del mercado."
    },
    footer: {
      company: "ILCalculator.pro",
      description: "An√°lisis DeFi profesional para proveedores de liquidez",
      terms: "T√©rminos de Servicio",
      privacy: "Pol√≠tica de Privacidad",
      refund: "Pol√≠tica de Reembolso",
      contact: "Cont√°ctanos",
      copyright: "¬© 2025 ILCalculator.pro",
      madeBy: "Hecho por Stefanson para la comunidad DeFi"
    },
    notifications: {
      dataCleared: "¬°Todos los datos eliminados! üßπ",
      welcomeDarkSide: "BIENVENIDO AL LADO OSCURO",
      clearConfirm: "¬øEliminar todos los datos guardados? Esto reiniciar√° todos los campos.",
      error: "Error"
    },
    tooltips: {
      upgradeTooltip: "Actualizar a Pro - Desbloquea todas las funciones",
      resetTooltip: "Eliminar todos los datos guardados - Reiniciar la Fuerza",
      lightSideTooltip: "Cambiar al Lado de la Luz",
      darkSideTooltip: "√önete al Lado Oscuro",
      changeLanguage: "Cambiar Idioma"
    },
    poolData: {
      topPools: "Top %s Pools (%d encontrados)",
      clickToUse: "Haz clic para usar APY",
      dataSource: "Datos de DefiLlama.",
      findingPools: "Buscando mejores pools para %s...",
      fetchingPrice: "Obteniendo datos de precios en vivo...",
      lastUpdated: "√öltima actualizaci√≥n: %s"
    }
  },
  pt: {
    header: {
      title: "Calculadora de Perda Impermanente",
      subtitle: "Ferramenta profissional de an√°lise DeFi para provedores de liquidez",
      upgradeButton: "PRO",
      resetButton: "RESET",
      themeButton: {
        dark: "ESCURO",
        light: "CLARO"
      }
    },
    calculator: {
      parameters: "Par√¢metros",
      parametersSubtitle: "Digite os detalhes da sua posi√ß√£o",
      protocol: "Protocolo AMM",
      protocolMulti: "MULTI-PROTOCOLO",
      selectToken: "Selecionar Token (Opcional)",
      livePrices: "PRE√áOS AO VIVO",
      liveData: "DADOS AO VIVO",
      initialPrice: "Pre√ßo Inicial ($)",
      currentPrice: "Pre√ßo Atual ($)",
      poolAPY: "APY do Pool (%)",
      poolAPYNew: "NOVO",
      investment: "Investimento ($)",
      refreshData: "Atualizar Dados ao Vivo",
      calculateButton: "Calcular Perda Impermanente",
      calculating: "Calculando...",
      updating: "Atualizando...",
      autoFilled: "AUTO-PREENCHIDO",
      popularPairs: "Pares populares: ETH/USDT ~25-45%, BTC/USDT ~15-30%"
    },
    results: {
      title: "Resultados da An√°lise",
      subtitle: "Performance da sua posi√ß√£o",
      hodlStrategy: "Estrat√©gia HODL",
      lpStrategy: "Estrat√©gia LP",
      lpStrategyWithFees: "+Taxas",
      impermanentLoss: "Perda Impermanente",
      betterStrategy: "Melhor Estrat√©gia",
      withoutFees: "Sem taxas",
      afterFees: "Ap√≥s taxas",
      scenarioAnalysis: "An√°lise de Cen√°rios",
      scenarioSubtitle: "Mudan√ßas de pre√ßo \"E se?\" - planeje sua estrat√©gia LP",
      feesAnalysis: "An√°lise de Taxas",
      feesSubtitle: "Detalhamento dos ganhos com taxas de trading",
      perDay: "Por Dia",
      perWeek: "Por Semana",
      perMonth: "Por M√™s",
      total: "Dias Total",
      breakEvenAnalysis: "An√°lise de Ponto de Equil√≠brio",
      breakEvenSubtitle: "Tempo para as taxas compensarem a PI",
      noILToCompensate: "Sem perda impermanente para compensar!",
      never: "Nunca",
      daysExactly: "dias exatamente"
    },
    education: {
      title: "Aprenda DeFi e Perda Impermanente",
      subtitle: "Domine os fundamentos de fornecer liquidez",
      realTimeData: "Dados de Pool em Tempo Real",
      dataDescription: "As taxas APY s√£o obtidas do Uniswap V3, PancakeSwap V3, Curve e outros protocolos DEX principais. Os dados s√£o atualizados a cada 6 horas para garantir precis√£o. Os valores de volume e TVL refletem as condi√ß√µes atuais do mercado."
    },
    footer: {
      company: "ILCalculator.pro",
      description: "An√°lise DeFi profissional para provedores de liquidez",
      terms: "Termos de Servi√ßo",
      privacy: "Pol√≠tica de Privacidade",
      refund: "Pol√≠tica de Reembolso",
      contact: "Fale Conosco",
      copyright: "¬© 2025 ILCalculator.pro",
      madeBy: "Feito por Stefanson para a comunidade DeFi"
    },
    notifications: {
      dataCleared: "Todos os dados limpos! üßπ",
      welcomeDarkSide: "BEM-VINDO AO LADO NEGRO",
      clearConfirm: "Limpar todos os dados salvos? Isso redefinir√° todos os campos.",
      error: "Erro"
    },
    tooltips: {
      upgradeTooltip: "Atualizar para Pro - Desbloqueie todos os recursos",
      resetTooltip: "Limpar todos os dados salvos - Redefinir a For√ßa",
      lightSideTooltip: "Mudar para o Lado da Luz",
      darkSideTooltip: "Junte-se ao Lado Negro",
      changeLanguage: "Mudar Idioma"
    },
    poolData: {
      topPools: "Top %s Pools (%d encontrados)",
      clickToUse: "Clique para usar APY",
      dataSource: "Dados do DefiLlama.",
      findingPools: "Encontrando melhores pools para %s...",
      fetchingPrice: "Buscando dados de pre√ßos ao vivo...",
      lastUpdated: "√öltima atualiza√ß√£o: %s"
    }
  }
};

export const useLanguage = () => {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useLanguage must be used within LanguageProvider');
  }
  return context;
};

export const LanguageProvider = ({ children }) => {
  const [language, setLanguage] = useState(() => {
    // Try to get language from localStorage or browser
    const saved = localStorage.getItem('ilc_language');
    if (saved && translations[saved]) return saved;
    
    const browserLang = navigator.language.split('-')[0];
    return translations[browserLang] ? browserLang : 'en';
  });

  const t = (key, ...params) => {
    const keys = key.split('.');
    let value = translations[language];
    
    for (const k of keys) {
      value = value?.[k];
      if (value === undefined) {
        console.warn(`Translation missing for key: ${key} in language: ${language}`);
        return key;
      }
    }
    
    // Simple string interpolation for %s and %d
    if (typeof value === 'string' && params.length > 0) {
      return value.replace(/%[sd]/g, (match) => {
        const param = params.shift();
        return param !== undefined ? param.toString() : match;
      });
    }
    
    return value;
  };

  const changeLanguage = (newLang) => {
    if (translations[newLang]) {
      setLanguage(newLang);
      localStorage.setItem('ilc_language', newLang);
    }
  };

  const availableLanguages = [
    { code: 'en', name: 'English', flag: 'üá∫üá∏' },
    { code: 'es', name: 'Espa√±ol', flag: 'üá™üá∏' },
    { code: 'pt', name: 'Portugu√™s', flag: 'üáßüá∑' }
  ];

  return (
    <LanguageContext.Provider value={{
      language,
      setLanguage: changeLanguage,
      t,
      availableLanguages
    }}>
      {children}
    </LanguageContext.Provider>
  );
};